---
title: SimCLR
published: 2024-07-12
description: ''
image: ''
tags: [æœºå™¨å­¦ä¹ ,åˆ†ç±»,è‡ªç›‘ç£å­¦ä¹ ,CV]
category: 'è®ºæ–‡é˜…è¯»'
draft: false 
---

::github{repo="google-research/simclr"}

[Self-Supervised Learning è¶…è¯¦ç»†è§£è¯» (äºŒ)ï¼šSimCLRç³»åˆ— - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/378953015)

## å‰è¨€

self-supervised learning,åˆå«è‡ªç›‘ç£å­¦ä¹ ,æ˜¯æ— ç›‘ç£å­¦ä¹ ä¸­çš„ä¸€ç§,ä¸»è¦å¸Œæœ›èƒ½å­¦ä¹ åˆ°ä¸€ç§é€šç”¨çš„ç‰¹å¾è¡¨è¾¾ç”¨äºä¸‹æ¸¸ä»»åŠ¡(Downstream Tasks),æ¯”å¦‚ç—…ç†åˆ†ç±»ä¸­å°±ç”¨äº†è¿™ç§æ–¹å¼,å…ˆå­¦ä¹ ç‰¹å¾,æŠŠå›¾ç‰‡è½¬ä¸ºä½ç»´Embeddingåå†å¤„ç†,å…¶ä¸»è¦çš„æ–¹å¼å°±æ˜¯è‡ªå·±ç›‘ç£è‡ªå·±.è‡ªç›‘ç£å­¦ä¹ ä¹Ÿæ˜¯å¤§åŠ¿æ‰€è¶‹.æ€»ç»“æ¥è¯´,è‡ªç›‘ç£å­¦ä¹ çš„æ–¹æ³•å°±æ˜¯:**Unsuperviesd Pre-train,Supervised Fine-tune**.

åœ¨é¢„è®­ç»ƒé˜¶æ®µä½¿ç”¨æ— æ ‡ç­¾æ•°æ®é›†,å› ä¸ºäººå·¥æ ‡ç­¾å¤ªè´µäº†.åœ¨è®­ç»ƒæ¨¡å‹å‚æ•°çš„æ—¶å€™æˆ‘ä»¬ä¸è¿½æ±‚ç”¨å¸¦æ ‡ç­¾æ•°æ®æŠŠæ¨¡å‹ä¸€æ­¥è®­ç»ƒåˆ°ä½,è€Œæ˜¯å…ˆè®­ç»ƒåˆæ­¥æˆå‹,ç„¶åå†è®­ç»ƒåˆ°å®Œå…¨æˆå‹.å‰é¢è¿™ä¸ªä½¿ç”¨æ— æ ‡ç­¾æ•°æ®åˆæ­¥æˆå‹çš„ä¸œè¥¿å«åš**Visual Representation**,ç„¶åå†ä½¿ç”¨ä¸‹æ¸¸ä»»åŠ¡ç”¨å¸¦æ ‡ç­¾çš„æ•°æ®æŠŠä»–å®Œå…¨è®­ç»ƒæˆå‹,è¿™ä¸ªæ—¶å€™æ•°æ®å°±ä¸éœ€è¦å¤ªå¤šäº†.

ç¬¬ä¸€ä¸ªé˜¶æ®µä¸æ¶‰åŠä»»ä½•ä¸‹æ¸¸ä»»åŠ¡,å°±æ˜¯æ‹¿ç€ä¸€å †æ— æ ‡ç­¾æ•°æ®è®­ç»ƒå°±å¥½äº†,è¿™ä¸ªç”¨å®˜æ–¹çš„è¡¨è¿°å«åš:**in a task-agnostic way**,ç¬¬äºŒä¸ªé˜¶æ®µæœ‰äº†æ ‡ç­¾å’Œä¸‹æ¸¸ä»»åŠ¡ä¸ŠåšFine-tune,è¿™ä¸ªå«åš**in a task-specific way**.![img](https://pic3.zhimg.com/v2-1b66c0009928e4b25a21850eb0bbfb6e_r.jpg)

æœ¬æ–‡ä¸»è¦ä»‹ç»Self-Supervised Learning åœ¨ **CV é¢†åŸŸ** çš„ç»å…¸å·¥ä½œä¹‹ä¸€ï¼šSimCLRå’ŒSimCLR v2ï¼Œå®ƒä»¬éƒ½æ˜¯å±äº **Contrastive** ç±»åˆ«çš„ã€‚

## åŸç†åˆ†æ

![image-20240712122044361](./assets/image-20240712122044361.png)

SimCLRåœ¨ImageNetä¸Šè¾¾åˆ°äº†76.5%çš„Top1å‡†ç¡®ç‡,å¦‚æœæŠŠè¿™ä¸ªé¢„è®­ç»ƒæ¨¡å‹ç”¨ **1%çš„ImageNetçš„æ ‡ç­¾**ç»™ **Fine-tune** ä¸€ä¸‹ï¼Œå€ŸåŠ©è¿™ä¸€ç‚¹ç‚¹çš„æœ‰ç›‘ç£ä¿¡æ¯ï¼ŒSimCLR å°±å¯ä»¥å†è¾¾åˆ° **85.5%** çš„ **Top 5** Accuracyï¼Œ

SimCLRä¹Ÿæ˜¯éµå¾ªå‰è¨€ä¸­çš„è®­ç»ƒæ–¹æ³•,ä»–çš„æ ¸å¿ƒå°±æ˜¯Contrastive,å°±æ˜¯è¯•å›¾æ•™ä¼šæœºå™¨åŒºåˆ†ç›¸ä¼¼å’Œä¸åŒçš„äº‹ç‰©.æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰4å¼ å›¾ç‰‡,æˆ‘ä»¬å¸Œæœ›å‰é¢ä¸¤å¼ ç‹—å°½å¯èƒ½ç›¸ä¼¼,ä¸ç¬¬ä¸‰å››å¼ å°½å¯èƒ½ä¸åŒ.ä½†æ˜¯ç”±äºæˆ‘ä»¬æ²¡æœ‰æ ‡ç­¾,å› æ­¤å¾ˆéš¾åšåˆ°è¿™ä¸ªäº‹æƒ….

![img](https://pic1.zhimg.com/80/v2-10b42ad8663bca627b7d86a4ab8c8134_720w.webp)

æ‰€ä»¥SimCLRçš„æ–¹æ³•å¦‚ä¸‹:

å‡è®¾ç°åœ¨æœ‰ä¸€å¼ å›¾ç‰‡xä½³ä½œOriginal Image,é¦–å…ˆå¯¹ä»–æ•°æ®å¢å¼º,å¾—åˆ°ä¸¤å¼ å¢å¼ºåçš„å›¾ç‰‡$x_i,x_j$,æ•°æ®å¢å¼ºæ–¹å¼æœ‰å¦‚ä¸‹ä¸‰ç§:

- éšæœºè£å‰ªåresizeæˆåŸæ¥çš„æ ·å­(Random crooping followed by resize back to the original size)
- éšæœºè‰²å½©å¤±çœŸ(Random Color distortions)
- éšæœºé«˜æ–¯æ¨¡ç³Š(Random Gaussian Deblur)

ç„¶åæŠŠå¢å¼ºåçš„å›¾ç‰‡è¾“å…¥åˆ°Encoderé‡Œ,æ³¨æ„è¿™ä¸¤ä¸ªEncoderå…±äº«å‚æ•°çš„,å¾—åˆ°ä»–ä»¬çš„representation$h_i,h_j$,åœ¨æŠŠ$h_i,h_j$é€šè¿‡Projection headå¾—åˆ°representaiton$z_i,z_j$.è¿™é‡Œçš„projection headä¾æ—§å…±äº«å‚æ•°.å…¶ä¸­$$z_i = g(h_i) = W^{(2)} \sigma(W^{(1)} h_i)$$.æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦æœ€å¤§åŒ–åŒä¸€å¼ å›¾ç‰‡å¾—åˆ°çš„$z_i,z_j$.è¿™å°±æ˜¯ä»–çš„æ–¹æ³•æ¦‚è¿°.

![img](https://pic4.zhimg.com/80/v2-a64b94ff65e2c03598ddfc5fe41dd57f_720w.webp)

## å…·ä½“å®ç°

### æ•°æ®å¢å¼º

åœ¨è®ºæ–‡ä¸­çš„batch_sizeæ˜¯8192.æˆ‘ä»¬å‡è®¾N=2.æ•°æ®å¢å¼ºçš„ä»£ç å¦‚ä¸‹:

```python
torchvision:transforms:RandomResizedCrop

from torchvision import transforms
def get_color_distortion(s=1.0):
# s is the strength of color distortion.
    color_jitter = transforms.ColorJitter(0.8*s, 0.8*s, 0.8*s, 0.2*s)
    rnd_color_jitter = transforms.RandomApply([color_jitter], p=0.8)
    rnd_gray = transforms.RandomGrayscale(p=0.2)
    color_distort = transforms.Compose([
    rnd_color_jitter,
    rnd_gray])

    return color_distort
  
random (crop + flip + color jitter + grayscale)
```

å¯¹åŒä¸€ä¸ªå›¾ç‰‡æˆ‘ä¹ˆèƒ½å¤Ÿå¾—åˆ°ä¸¤ä¸ªä¸åŒçš„æ•°æ®å¢å¼ºçš„ç»“æœ,æ‰€ä»¥ä¸€ä¸ªBatchæœ‰4ä¸ªImage.

### é€šè¿‡Encoderè·å¾—å›¾ç‰‡è¡¨å¾

æˆ‘ä»¬ä½¿ç”¨ResNet50ä½œä¸ºEncoder,è¾“å‡º2048ç»´å‘é‡h

### é¢„æµ‹å¤´

é¢„æµ‹å¤´æ˜¯ä¸€ä¸ªåŒå±‚MLP,å°†2048ç»´åº¦å‘é‡æ˜ å°„åˆ°128ç»´åº¦ç©ºé—´ä¸­,å¾—åˆ°æ–°çš„representation$z_i,z_j$.ç„¶åå»è®¡ç®—losså®Œæˆè®­ç»ƒ.è®­ç»ƒå®Œå¯ä»¥æ‰”æ‰é¢„æµ‹å¤´.

### ç›¸ä¼¼å›¾ç‰‡è¾“å‡ºæ›´è¿‘

åˆ°è¿™ä¸€æ­¥åå¯¹äºæ¯ä¸ªBatch,æˆ‘ä»¬éƒ½èƒ½å¾—åˆ°ä»–ä»¬çš„visual represenstation $z_i$.

é¦–å…ˆæˆ‘ä»¬è¦å®šä¹‰Representationä¹‹é—´çš„ç›¸ä¼¼åº¦,æ¯”å¦‚ä½™å¼¦ç›¸ä¼¼åº¦Cosine Similarity,è¿™æ ·æˆ‘ä»¬å°±èƒ½æŠŠä¸¤ä¸ªå›¾ç‰‡çš„ç›¸ä¼¼åº¦è½¬æ¢ä¸ºä¸¤ä¸ªrepresentaionä¹‹é—´çš„è®¡ç®—ï¼š$$s_{i,j} = \frac{z_i^\top z_j}{\tau \|z_i\| \|z_j\|}$$.å¼ä¸­ï¼Œ$\tau$ æ˜¯å¯è°ƒèŠ‚çš„ Temperature å‚æ•°ã€‚å®ƒèƒ½å¤Ÿ scale è¾“å…¥å¹¶æ‰©å±•ä½™å¼¦ç›¸ä¼¼åº¦ [-1, 1]è¿™ä¸ªèŒƒå›´ã€‚

ç†æƒ³æƒ…å†µä¸‹ç‹—ç‹—ä¹‹é—´çš„ç›¸ä¼¼åº¦é«˜,ç‹—å’Œé²¸é±¼çš„ç›¸ä¼¼åº¦ä½.

![img](https://pic1.zhimg.com/80/v2-5d3b80663abc2754be51b38afb56a64c_720w.webp)

åˆ°ç°åœ¨æˆ‘ä»¬æœ‰äº†è¡¡é‡ç›¸ä¼¼åº¦çš„æ–¹æ³•,ä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯è¦è½¬ä¸ºå¯ä»¥ä¼˜åŒ–çš„æŸå¤±å‡½æ•°æ‰å¯ä»¥.æ–‡ä¸­å¼€å‘äº†ä¸€ç§å«NT-Xent loss (Normalized Temperature-Scaled Cross-Entropy Loss)çš„å¯¹æ¯”æŸå¤±å‡½æ•°.å…·ä½“æ–¹æ³•å¦‚ä¸‹:

é¦–å…ˆæˆ‘ä»¬æ‹¿å‡ºæ¥ç¬¬ä¸€ä¸ªpair(æ¯”å¦‚æ˜¯ä¸¤åªç‹—),ä½¿ç”¨softmaxè®¡ç®—ä¸¤å›¾åƒç›¸ä¼¼çš„æ¦‚ç‡.![img](https://pic1.zhimg.com/80/v2-d2fadcdea7ae129c6791f92b49779964_720w.webp)

ä¸ºäº†è®©softmaxçš„ç»“æœå°½å¯èƒ½å¤§,æ‰€ä»¥æˆ‘ä»¬å¯¹softmaxå–äº†è´Ÿå¯¹æ•°.
$$
l(i, j) = - \log \frac{\exp(s_{i,j})}{\sum_{k=1}^{2N} \mathbf{1}[k \ne i] \exp(s_{i,k})}
$$
ç„¶åæˆ‘ä»¬æŠŠå›¾ç‰‡è°ƒæ¢ä½ç½®åå†è®¡ç®—ä¸€æ¬¡,æœ€åè®¡ç®—æ‰€æœ‰pairçš„æŸå¤±å‡½æ•°å’Œçš„å¹³å‡å€¤.![img](https://pic2.zhimg.com/80/v2-413a90fab06344d5b7c59f21a5772999_720w.webp)

### ä¸‹æ¸¸ä»»åŠ¡Fine-tune

åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»åœ¨æ²¡æœ‰ä»»ä½•æ ‡ç­¾çš„æƒ…å†µä¸‹è®­ç»ƒå¥½äº†SimCLRæ¨¡å‹,è®©ä»–çš„Encoderå¯ä»¥è¾“å‡ºå›¾ç‰‡çš„Representationä¿¡æ¯.å¯ä»¥ç”¨äºè¿ç§»å­¦ä¹ äº†.è¿™ä¸ªæ—¶å€™éœ€è¦çš„æ•°æ®é‡å¾ˆå°.

**76.5% æ˜¯é€šè¿‡Linear Evaluationå¾—åˆ°çš„ã€‚**

æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼è¿›è¡Œå®ŒPre-trainä¹‹åï¼ŒEncoderéƒ¨åˆ†å’ŒProjection headéƒ¨åˆ†çš„æƒé‡ä¹Ÿå°±ç¡®å®šäº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»æ‰Projection headçš„éƒ¨åˆ†ï¼Œåœ¨Encoderè¾“å‡ºçš„ â„ğ‘–,â„ğ‘— ä¹‹åå†æ·»åŠ ä¸€ä¸ª**çº¿æ€§åˆ†ç±»å™¨ (Linear Classifier)**ï¼Œå®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªFCå±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨å…¨éƒ¨çš„ ImageNet **å»è®­ç»ƒè¿™ä¸ª Linear Classifier**ï¼Œå…·ä½“æ–¹æ³•æ˜¯æŠŠé¢„è®­ç»ƒéƒ¨åˆ†ï¼Œå³ â„ğ‘–,â„ğ‘— ä¹‹å‰çš„æƒé‡frozenä½ï¼Œåªè®­ç»ƒçº¿æ€§åˆ†ç±»å™¨çš„å‚æ•°ï¼Œé‚£ä¹ˆ Test Accuracy å°±ä½œä¸º a proxy for representation qualityï¼Œå°±æ˜¯76.5%ã€‚

**85.5% æ˜¯é€šè¿‡Fine-tuningå¾—åˆ°çš„ã€‚**

æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼è¿›è¡Œå®ŒPre-trainä¹‹åï¼ŒEncoderéƒ¨åˆ†å’ŒProjection headéƒ¨åˆ†çš„æƒé‡ä¹Ÿå°±ç¡®å®šäº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»æ‰Projection headçš„éƒ¨åˆ†ï¼Œåœ¨Encoderè¾“å‡ºçš„ â„ğ‘–,â„ğ‘— ä¹‹åå†æ·»åŠ ä¸€ä¸ª**çº¿æ€§åˆ†ç±»å™¨ (Linear Classifier)**ï¼Œå®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªFCå±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨ **1%çš„ImageNet çš„æ ‡ç­¾** **å»è®­ç»ƒæ•´ä¸ªç½‘ç»œ**ï¼Œä¸å›ºå®š Encoder çš„æƒé‡äº†ã€‚é‚£ä¹ˆæœ€åçš„ Test Accuracy å°±æ˜¯85.5%ã€‚

Linear Evaluation å’Œ Fine-tuningçš„ç²¾åº¦çš„å…³ç³»å¦‚ä¸‹å›¾20æ‰€ç¤ºï¼šå½“Linear Evaluation çš„ç²¾åº¦è¾¾åˆ°76.5% Top1 Accuracyæ—¶ï¼ŒFine-tuningçš„ç²¾åº¦è¾¾åˆ°äº†50å¤šï¼Œå› ä¸ºFine-tuning åªä½¿ç”¨äº†1%çš„æ ‡ç­¾ï¼Œè€ŒLinear Evaluation ä½¿ç”¨äº†100%çš„æ ‡ç­¾ã€‚

![img](https://pic3.zhimg.com/80/v2-f07b8f7427c3fd51b8acb0b3c5e5bc8e_720w.webp)

